cmake_minimum_required(VERSION 3.10.2)
project(ssp_server)

include_directories("/libs/include")
link_directories("/libs/lib")

set(CMAKE_CXX_STANDARD 11)

list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/CMakeModules" "/libs/lib")
list(APPEND CMAKE_PREFIX_PATH "/libs/lib")

find_package(Threads REQUIRED)
find_package(OpenCV REQUIRED)
find_package(FFmpeg REQUIRED PATHS "/libs/lib/ffmpeg")

set(EXECUTABLE_OUTPUT_PATH bin)

option(SSP_WITH_KINECT_SUPPORT "This is settable from the command line" ON)
option(SSP_WITH_K4A_BODYTRACK "This is settable from the command line" ON)
option(SSP_WITH_NVPIPE_SUPPORT "This is settable from the command line" OFF)
option(SSP_WITH_ZMQ_POLLING "This is settable from the command line" ON)

add_definitions(-DSSP_WITH_KINECT_SUPPORT=1)
add_definitions(-DSSP_WITH_K4A_BODYTRACK=1)

add_definitions(-DSSP_WITH_ZMQ_POLLING=1)

set(SOURCE_FILES readers/image_reader.cc readers/multi_image_reader.cc structs/frame_struct.hpp utils/utils.cc utils/video_utils.cc utils/image_decoder.cc utils/image_converter.cc)
set(DECODER_SOURCE_FILES decoders/libav_decoder.cc decoders/zdepth_decoder.cc)
set(ENCODER_SOURCE_FILES encoders/zdepth_encoder.cc encoders/null_encoder.cc encoders/libav_encoder.cc)
set(READER_SOURCE_FILES readers/video_file_reader.cc readers/image_reader.cc)

set(KINECT_READER_SOURCE_FILES readers/kinect_reader.cc utils/kinect_utils.cc)

set(READER_SOURCE_FILES ${READER_SOURCE_FILES} readers/kinect_reader.cc utils/kinect_utils.cc)

add_executable(ssp_server servers/ssp_server.cc ${READER_SOURCE_FILES} ${DECODER_SOURCE_FILES} ${ENCODER_SOURCE_FILES} ${SOURCE_FILES})

set(LIB_FILES avcodec avdevice avfilter avformat avutil k4a k4abt k4arecord postproc swresample swscale yaml-cpp zdepth zmq zstd)

target_link_libraries(ssp_server ${LIB_FILES})
target_link_libraries(ssp_client_plugin ${OpenCV_LIBS})
